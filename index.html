<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/jspsych@7.3.1"></script>
        <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.2"></script>
        <!-- <script src="../../packages/extension-record-video/dist/index.browser.js"></script> -->
        <script src="https://unpkg.com/@jspsych/extension-record-video@1.0.1"></script>
        <!-- <script src="../../packages/plugin-initialize-camera/dist/index.browser.js"></script> -->
        <script src="https://unpkg.com/@jspsych/plugin-initialize-camera@1.0.1"></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/jspsych@7.3.1/css/jspsych.css"
        />
    </head>
    <body></body>
    <script>

        const jsPsych = initJsPsych({
            extensions: [{ type: jsPsychExtensionRecordVideo }],
            on_finish: function () {
                jsPsych.data.get().localSave("json", "data.json")
                jsPsych.data.displayData("json")
            },
        })

        const init_camera = {
            type: jsPsychInitializeCamera,
        }

        // Create marker to set onset/offset for photosensor
        function create_marker(marker_position, color = "black") {
            const html = `<div id="marker" style="position: absolute; background-color: ${color};\
            left:${marker_position[0]}px; top:${marker_position[1]}px; \
            width:${marker_position[2]}px; height:${marker_position[3]}px";></div>`
            document.querySelector("body").insertAdjacentHTML("beforeend", html)

        }

        marker_position = [0, 0, 100, 100]

        // function to remove marker after set interval
        function TimeOut() {
            document.querySelector("#marker").remove()
        }

        const trial = {
            type: jsPsychHtmlButtonResponse,
            stimulus: `<p>Video is recording.<br><br>Click done after a few seconds.</p>`,
            choices: ["Done"],
            extensions: [{ type: jsPsychExtensionRecordVideo }],
            on_start: function(){
                create_marker(marker_position, (color='black')),
                setTimeout(TimeOut, 500)   // 500 milliseconds
            },
            on_finish: function () {
                create_marker(marker_position, (color='black')),
                setTimeout(TimeOut, 500)   // 500 milliseconds
            },
        }

        jsPsych.run([init_camera, trial])


    </script>
</html>
